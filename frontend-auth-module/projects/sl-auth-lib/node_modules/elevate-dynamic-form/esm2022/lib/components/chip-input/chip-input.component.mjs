import { Component, Input } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DialogInputComponent } from '../dialog-input/dialog-input.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
import * as i4 from "@angular/material/icon";
import * as i5 from "@angular/material/chips";
import * as i6 from "@angular/material/slide-toggle";
export class ChipInputComponent {
    constructor(diaglog) {
        this.diaglog = diaglog;
        this.enableSelectAll = false;
        this.touched = false;
        this.onChange = (value) => { };
        this.onTouched = () => { };
    }
    ngOnInit() { }
    writeValue(value) {
        this.selectedChips = new Set();
        this.chipControl.options.map((chipItem) => {
            if (value) {
                value.forEach((val) => {
                    if (val.value == chipItem.value) {
                        this.selectedChips.add(chipItem);
                    }
                });
            }
        });
        if (this.selectedChips.size === this.chipControl.options.length) {
            this.enableSelectAll = true;
        }
    }
    registerOnChange(onChange) {
        this.onChange = onChange;
    }
    registerOnTouched(onTouched) {
        this.onTouched = onTouched;
    }
    markAsTouched() {
        if (!this.touched) {
            this.onTouched();
            this.touched = true;
        }
    }
    onChipClick(chip) {
        this.markAsTouched();
        if (this.selectedChips.has(chip)) {
            this.selectedChips.delete(chip);
        }
        else {
            this.selectedChips.add(chip);
        }
        if (this.selectedChips.size) {
            this.onChange([...this.selectedChips]);
        }
        else {
            this.onChange([]);
        }
        this.enableSelectAll =
            this.selectedChips.size == this.chipControl.options.length;
    }
    addOption() {
        const dialogRef = this.diaglog.open(DialogInputComponent, {
            data: {
                header: this.chipControl.meta.addNewPopupHeader,
                label: this.chipControl.meta.addNewPopupSubHeader,
                required: true,
                maxLength: 20,
                buttonText: {
                    ok: 'Add',
                    cancel: 'Cancel',
                },
            },
            width: '450px',
        });
        dialogRef.afterClosed().subscribe((data) => {
            if (data && data !== '') {
                let newOption = {
                    label: data,
                    value: data,
                };
                this.chipControl.options.push(newOption);
                this.onChipClick(newOption);
            }
        });
    }
    toggleSelectAll() {
        this.markAsTouched();
        if (this.enableSelectAll) {
            this.chipControl.options.map((chipItem) => {
                this.selectedChips.add(chipItem);
            });
        }
        else {
            this.selectedChips.clear();
        }
        if (this.selectedChips.size) {
            this.onChange([...this.selectedChips]);
        }
        else {
            this.onChange([]);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.8", ngImport: i0, type: ChipInputComponent, deps: [{ token: i1.MatDialog }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.8", type: ChipInputComponent, selector: "lib-chip-input", inputs: { chipControl: "chipControl" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: ChipInputComponent,
                multi: true,
            },
        ], ngImport: i0, template: "<mat-chip-listbox\n  #chipList\n  [multiple]=\"chipControl?.multiple\"\n  [required]=\"chipControl?.validators?.required\"\n  style=\"margin-top: 10px\"\n>\n  <div class=\"chip-options-list\">\n    <mat-chip-option\n      *ngFor=\"let chip of chipControl?.options\"\n      [value]=\"chip.value\"\n      (click)=\"onChipClick(chip)\"\n      [selected]=\"this.selectedChips.has(chip)\"\n    >\n      <div>{{ chip?.label }}</div>\n      <mat-icon\n        matChipRemove\n        *ngIf=\"this.selectedChips.has(chip)\"\n        (click)=\"onChipClick(chip)\"\n      >\n        cancel\n      </mat-icon>\n    </mat-chip-option>\n    <mat-chip\n      *ngIf=\"chipControl?.meta?.showAddOption\"\n      (click)=\"addOption()\"\n      style=\"cursor: pointer\"\n    >\n      <mat-icon>add_circle</mat-icon> Add\n    </mat-chip>\n  </div>\n  <mat-slide-toggle\n    *ngIf=\"chipControl?.meta?.showSelectAll\"\n    [(ngModel)]=\"enableSelectAll\"\n    (change)=\"toggleSelectAll()\"\n  ></mat-slide-toggle>\n</mat-chip-listbox>\n", styles: [".chip-options-list{display:flex;flex-direction:row;flex:1;flex-wrap:wrap}\n"], dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i4.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i5.MatChip, selector: "mat-basic-chip, [mat-basic-chip], mat-chip, [mat-chip]", inputs: ["role", "id", "aria-label", "aria-description", "value", "color", "removable", "highlighted", "disableRipple", "disabled", "tabIndex"], outputs: ["removed", "destroyed"], exportAs: ["matChip"] }, { kind: "component", type: i5.MatChipListbox, selector: "mat-chip-listbox", inputs: ["multiple", "aria-orientation", "selectable", "compareWith", "required", "hideSingleSelectionIndicator", "value"], outputs: ["change"] }, { kind: "component", type: i5.MatChipOption, selector: "mat-basic-chip-option, [mat-basic-chip-option], mat-chip-option, [mat-chip-option]", inputs: ["selectable", "selected"], outputs: ["selectionChange"] }, { kind: "directive", type: i5.MatChipRemove, selector: "[matChipRemove]" }, { kind: "component", type: i6.MatSlideToggle, selector: "mat-slide-toggle", inputs: ["name", "id", "labelPosition", "aria-label", "aria-labelledby", "aria-describedby", "required", "color", "disabled", "disableRipple", "tabIndex", "checked", "hideIcon"], outputs: ["change", "toggleChange"], exportAs: ["matSlideToggle"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.8", ngImport: i0, type: ChipInputComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-chip-input', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: ChipInputComponent,
                            multi: true,
                        },
                    ], template: "<mat-chip-listbox\n  #chipList\n  [multiple]=\"chipControl?.multiple\"\n  [required]=\"chipControl?.validators?.required\"\n  style=\"margin-top: 10px\"\n>\n  <div class=\"chip-options-list\">\n    <mat-chip-option\n      *ngFor=\"let chip of chipControl?.options\"\n      [value]=\"chip.value\"\n      (click)=\"onChipClick(chip)\"\n      [selected]=\"this.selectedChips.has(chip)\"\n    >\n      <div>{{ chip?.label }}</div>\n      <mat-icon\n        matChipRemove\n        *ngIf=\"this.selectedChips.has(chip)\"\n        (click)=\"onChipClick(chip)\"\n      >\n        cancel\n      </mat-icon>\n    </mat-chip-option>\n    <mat-chip\n      *ngIf=\"chipControl?.meta?.showAddOption\"\n      (click)=\"addOption()\"\n      style=\"cursor: pointer\"\n    >\n      <mat-icon>add_circle</mat-icon> Add\n    </mat-chip>\n  </div>\n  <mat-slide-toggle\n    *ngIf=\"chipControl?.meta?.showSelectAll\"\n    [(ngModel)]=\"enableSelectAll\"\n    (change)=\"toggleSelectAll()\"\n  ></mat-slide-toggle>\n</mat-chip-listbox>\n", styles: [".chip-options-list{display:flex;flex-direction:row;flex:1;flex-wrap:wrap}\n"] }]
        }], ctorParameters: () => [{ type: i1.MatDialog }], propDecorators: { chipControl: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpcC1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9keW5hbWljLWZvcm0vc3JjL2xpYi9jb21wb25lbnRzL2NoaXAtaW5wdXQvY2hpcC1pbnB1dC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9keW5hbWljLWZvcm0vc3JjL2xpYi9jb21wb25lbnRzL2NoaXAtaW5wdXQvY2hpcC1pbnB1dC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFekUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7Ozs7Ozs7O0FBYzlFLE1BQU0sT0FBTyxrQkFBa0I7SUFNN0IsWUFBb0IsT0FBa0I7UUFBbEIsWUFBTyxHQUFQLE9BQU8sQ0FBVztRQUh0QyxvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUNqQyxZQUFPLEdBQVksS0FBSyxDQUFDO1FBSXpCLGFBQVEsR0FBRyxDQUFDLEtBQVUsRUFBRSxFQUFFLEdBQUUsQ0FBQyxDQUFDO1FBRTlCLGNBQVMsR0FBRyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUM7SUFKb0IsQ0FBQztJQU0xQyxRQUFRLEtBQUksQ0FBQztJQUViLFVBQVUsQ0FBQyxLQUFVO1FBQ25CLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFhLEVBQUUsRUFBRTtZQUM3QyxJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUNWLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRTtvQkFDekIsSUFBSSxH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Q0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFhLEVBQUUsRUFBRTtnQkFDN0MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDN0IsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUM1QixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUN6QyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEIsQ0FBQztJQUNILENBQUM7OEdBekdVLGtCQUFrQjtrR0FBbEIsa0JBQWtCLGlGQVJsQjtZQUNUO2dCQUNFLE9BQU8sRUFBRSxpQkFBaUI7Z0JBQzFCLFdBQVcsRUFBRSxrQkFBa0I7Z0JBQy9CLEtBQUssRUFBRSxJQUFJO2FBQ1o7U0FDRiwwQkNmSCwwL0JBb0NBOzsyRkRuQmEsa0JBQWtCO2tCQVo5QixTQUFTOytCQUNFLGdCQUFnQixhQUdmO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsb0JBQW9COzRCQUMvQixLQUFLLEVBQUUsSUFBSTt5QkFDWjtxQkFDRjs4RUFHUSxXQUFXO3NCQUFuQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgRGlhbG9nSW5wdXRDb21wb25lbnQgfSBmcm9tICcuLi9kaWFsb2ctaW5wdXQvZGlhbG9nLWlucHV0LmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2xpYi1jaGlwLWlucHV0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NoaXAtaW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jaGlwLWlucHV0LmNvbXBvbmVudC5jc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogQ2hpcElucHV0Q29tcG9uZW50LFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgQ2hpcElucHV0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIEBJbnB1dCgpIGNoaXBDb250cm9sOiBhbnk7XG4gIHNlbGVjdGVkQ2hpcHM6IGFueTtcbiAgZW5hYmxlU2VsZWN0QWxsOiBib29sZWFuID0gZmFsc2U7XG4gIHRvdWNoZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRpYWdsb2c6IE1hdERpYWxvZykge31cblxuICBvbkNoYW5nZSA9ICh2YWx1ZTogYW55KSA9PiB7fTtcblxuICBvblRvdWNoZWQgPSAoKSA9PiB7fTtcblxuICBuZ09uSW5pdCgpIHt9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5zZWxlY3RlZENoaXBzID0gbmV3IFNldCgpO1xuICAgIHRoaXMuY2hpcENvbnRyb2wub3B0aW9ucy5tYXAoKGNoaXBJdGVtOiBhbnkpID0+IHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB2YWx1ZS5mb3JFYWNoKCh2YWw6IGFueSkgPT4ge1xuICAgICAgICAgIGlmICh2YWwudmFsdWUgPT0gY2hpcEl0ZW0udmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDaGlwcy5hZGQoY2hpcEl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZENoaXBzLnNpemUgPT09IHRoaXMuY2hpcENvbnRyb2wub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuZW5hYmxlU2VsZWN0QWxsID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKG9uQ2hhbmdlOiBhbnkpIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gb25DaGFuZ2U7XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChvblRvdWNoZWQ6IGFueSkge1xuICAgIHRoaXMub25Ub3VjaGVkID0gb25Ub3VjaGVkO1xuICB9XG5cbiAgbWFya0FzVG91Y2hlZCgpIHtcbiAgICBpZiAoIXRoaXMudG91Y2hlZCkge1xuICAgICAgdGhpcy5vblRvdWNoZWQoKTtcbiAgICAgIHRoaXMudG91Y2hlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgb25DaGlwQ2xpY2soY2hpcDogYW55KSB7XG4gICAgdGhpcy5tYXJrQXNUb3VjaGVkKCk7XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRDaGlwcy5oYXMoY2hpcCkpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRDaGlwcy5kZWxldGUoY2hpcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRDaGlwcy5hZGQoY2hpcCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNlbGVjdGVkQ2hpcHMuc2l6ZSkge1xuICAgICAgdGhpcy5vbkNoYW5nZShbLi4udGhpcy5zZWxlY3RlZENoaXBzXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25DaGFuZ2UoW10pO1xuICAgIH1cblxuICAgIHRoaXMuZW5hYmxlU2VsZWN0QWxsID1cbiAgICAgIHRoaXMuc2VsZWN0ZWRDaGlwcy5zaXplID09IHRoaXMuY2hpcENvbnRyb2wub3B0aW9ucy5sZW5ndGg7XG4gIH1cblxuICBhZGRPcHRpb24oKSB7XG4gICAgY29uc3QgZGlhbG9nUmVmID0gdGhpcy5kaWFnbG9nLm9wZW4oRGlhbG9nSW5wdXRDb21wb25lbnQsIHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaGVhZGVyOiB0aGlzLmNoaXBDb250cm9sLm1ldGEuYWRkTmV3UG9wdXBIZWFkZXIsXG4gICAgICAgIGxhYmVsOiB0aGlzLmNoaXBDb250cm9sLm1ldGEuYWRkTmV3UG9wdXBTdWJIZWFkZXIsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICBtYXhMZW5ndGg6IDIwLFxuICAgICAgICBidXR0b25UZXh0OiB7XG4gICAgICAgICAgb2s6ICdBZGQnLFxuICAgICAgICAgIGNhbmNlbDogJ0NhbmNlbCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgd2lkdGg6ICc0NTBweCcsXG4gICAgfSk7XG5cbiAgICBkaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xuICAgICAgaWYgKGRhdGEgJiYgZGF0YSAhPT0gJycpIHtcbiAgICAgICAgbGV0IG5ld09wdGlvbiA9IHtcbiAgICAgICAgICBsYWJlbDogZGF0YSxcbiAgICAgICAgICB2YWx1ZTogZGF0YSxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jaGlwQ29udHJvbC5vcHRpb25zLnB1c2gobmV3T3B0aW9uKTtcbiAgICAgICAgdGhpcy5vbkNoaXBDbGljayhuZXdPcHRpb24pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlU2VsZWN0QWxsKCkge1xuICAgIHRoaXMubWFya0FzVG91Y2hlZCgpO1xuICAgIGlmICh0aGlzLmVuYWJsZVNlbGVjdEFsbCkge1xuICAgICAgdGhpcy5jaGlwQ29udHJvbC5vcHRpb25zLm1hcCgoY2hpcEl0ZW06IGFueSkgPT4ge1xuICAgICAgICB0aGlzLnNlbGVjdGVkQ2hpcHMuYWRkKGNoaXBJdGVtKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkQ2hpcHMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZENoaXBzLnNpemUpIHtcbiAgICAgIHRoaXMub25DaGFuZ2UoWy4uLnRoaXMuc2VsZWN0ZWRDaGlwc10pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlKFtdKTtcbiAgICB9XG4gIH1cbn1cbiIsIjxtYXQtY2hpcC1saXN0Ym94XG4gICNjaGlwTGlzdFxuICBbbXVsdGlwbGVdPVwiY2hpcENvbnRyb2w/Lm11bHRpcGxlXCJcbiAgW3JlcXVpcmVkXT1cImNoaXBDb250cm9sPy52YWxpZGF0b3JzPy5yZXF1aXJlZFwiXG4gIHN0eWxlPVwibWFyZ2luLXRvcDogMTBweFwiXG4+XG4gIDxkaXYgY2xhc3M9XCJjaGlwLW9wdGlvbnMtbGlzdFwiPlxuICAgIDxtYXQtY2hpcC1vcHRpb25cbiAgICAgICpuZ0Zvcj1cImxldCBjaGlwIG9mIGNoaXBDb250cm9sPy5vcHRpb25zXCJcbiAgICAgIFt2YWx1ZV09XCJjaGlwLnZhbHVlXCJcbiAgICAgIChjbGljayk9XCJvbkNoaXBDbGljayhjaGlwKVwiXG4gICAgICBbc2VsZWN0ZWRdPVwidGhpcy5zZWxlY3RlZENoaXBzLmhhcyhjaGlwKVwiXG4gICAgPlxuICAgICAgPGRpdj57eyBjaGlwPy5sYWJlbCB9fTwvZGl2PlxuICAgICAgPG1hdC1pY29uXG4gICAgICAgIG1hdENoaXBSZW1vdmVcbiAgICAgICAgKm5nSWY9XCJ0aGlzLnNlbGVjdGVkQ2hpcHMuaGFzKGNoaXApXCJcbiAgICAgICAgKGNsaWNrKT1cIm9uQ2hpcENsaWNrKGNoaXApXCJcbiAgICAgID5cbiAgICAgICAgY2FuY2VsXG4gICAgICA8L21hdC1pY29uPlxuICAgIDwvbWF0LWNoaXAtb3B0aW9uPlxuICAgIDxtYXQtY2hpcFxuICAgICAgKm5nSWY9XCJjaGlwQ29udHJvbD8ubWV0YT8uc2hvd0FkZE9wdGlvblwiXG4gICAgICAoY2xpY2spPVwiYWRkT3B0aW9uKClcIlxuICAgICAgc3R5bGU9XCJjdXJzb3I6IHBvaW50ZXJcIlxuICAgID5cbiAgICAgIDxtYXQtaWNvbj5hZGRfY2lyY2xlPC9tYXQtaWNvbj4gQWRkXG4gICAgPC9tYXQtY2hpcD5cbiAgPC9kaXY+XG4gIDxtYXQtc2xpZGUtdG9nZ2xlXG4gICAgKm5nSWY9XCJjaGlwQ29udHJvbD8ubWV0YT8uc2hvd1NlbGVjdEFsbFwiXG4gICAgWyhuZ01vZGVsKV09XCJlbmFibGVTZWxlY3RBbGxcIlxuICAgIChjaGFuZ2UpPVwidG9nZ2xlU2VsZWN0QWxsKClcIlxuICA+PC9tYXQtc2xpZGUtdG9nZ2xlPlxuPC9tYXQtY2hpcC1saXN0Ym94PlxuIl19